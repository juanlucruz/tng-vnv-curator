{
  "test":{
    "author":"Ignacio Dominguez, Felipe Vicens (ATOS)",
    "description":"Performance test for video analysis",
    "descriptor_schema":"https://raw.githubusercontent.com/sonata-nfv/tng-schema/master/test-descriptor/testdescriptor-schema.yml",
    "name":"test-immersive-media",
    "vendor":"eu.5gtango.atos",
    "version":"0.1",
    "phases":[
      {
        "id":"setup",
        "steps":[
          {
            "action":"deploy",
            "description":"Deploying a NS",
            "name":"deployment"
          },
          {
            "action":"configure",
            "description":null,
            "name":"configuration",
            "probes":[
              {
                "description":"A service initial configuration container",
                "id":"initiator",
                "image":"ignaciodomin/media-initiator:dev",
                "name":"initiator",
                "parameters":[
                  {
                    "key":"CAMERA",
                    "value":"test"
                  },
                  {
                    "key":"CMS",
                    "value":"10.200.16.10"
                  },
                  {
                    "key":"MA",
                    "value":"10.200.16.12"
                  },
                  {
                    "key":"MSE",
                    "value":"10.200.16.11"
                  }
                ]
              },
              {
                "id":"ffprobe",
                "name":"ffprobe",
                "image":"ignaciodomin/media-ffprobe:dev",
                "description":"Ffprobe",
                "parameters":[
                  {
                    "key":"STREAMING_ENGINE",
                    "value":"10.200.16.11"
                  },
                  {
                    "key":"STREAM",
                    "value":"test"
                  }
                ]
              },
              {
                "id":"parser",
                "name":"parser",
                "image":"ignaciodomin/media-parser:dev",
                "description":"Parser",
                "parameters":[

                ]
              },
              {
                "description":"Content Producer Emulator (CPE) To generate a RTMP flow",
                "id":"cpe",
                "image":"ignaciodomin/media-cpe:plane",
                "name":"cpe",
                "parameters":[
                  {
                    "key":"AGGREGATOR",
                    "value":"10.200.16.12"
                  },
                  {
                    "key":"APP",
                    "value":"test"
                  },
                  {
                    "key":"STREAM",
                    "value":"test"
                  }
                ]
              },
              {
                "description":"Content Consumer Emulator (CCE) To play HLS flows from Streaming engine",
                "id":"cce",
                "image":"ignaciodomin/media-cce:dev",
                "name":"cce",
                "parameters":[
                  {
                    "key":"STREAMING_ENGINE",
                    "value":"10.200.16.11"
                  },
                  {
                    "key":"STREAM",
                    "value":"test"
                  }
                ]
              }
            ]
          }
        ]
      },
      {
        "id":"exercise",
        "steps":[
          {
            "name":"initiator",
            "description":"Starting the initiator",
            "run":"initiator",
            "index":1,
            "entrypoint":"/app/entrypoint.sh",
            "command":"/bin/sh",
            "instances":1,
            "output":[
              {
                "results":"logs.txt"
              }
            ],
            "dependencies":[

            ]
          },
          {
            "name":"cpe",
            "description":"Starting the CPE that simulates the camera",
            "run":"cpe",
            "index":1,
            "start_delay":5,
            "entrypoint":"/app/entrypoint.sh",
            "command":"/bin/sh",
            "instances":1,
            "output":[
              {
                "results":"logs.txt"
              }
            ]
          },
          {
            "name":"ffprobe",
            "description":"Starting the CCE that simulates the consumer",
            "run":"ffprobe",
            "index":2,
            "entrypoint":"/app/entrypoint.sh",
            "start_delay":10,
            "instances":1,
            "output":[
              {
                "results":"logs.txt"
              }
            ],
            "dependencies":[
              "initiator"
            ]
          },
          {
            "name":"cce",
            "description":"Starting the CCE that simulates the consumer",
            "run":"cce",
            "index":3,
            "entrypoint":"/app/entrypoint.sh",
            "start_delay":25,
            "instances":1,
            "output":[
              {
                "results":"logs.txt"
              }
            ],
            "dependencies":[
              "initiator"
            ]
          },
          {
            "name":"parser",
            "description":"Starting the CCE that simulates the consumer",
            "run":"parser",
            "index":4,
            "entrypoint":"/app/entrypoint.sh",
            "instances":1,
            "output":[
              {
                "results":"result.json"
              }
            ],
            "dependencies":[
              "initiator",
              "cpe",
              "ffprobe",
              "cce"
            ]
          }
        ]
      },
      {
        "id":"verification",
        "steps":[
          {
            "name":"parser",
            "description":"Check obtained results",
            "step":"parser",
            "conditions":[
              {
                "name":"lost-frames",
                "file":"result.json",
                "type":"json",
                "find":"lost-frames",
                "condition":"<",
                "value":"90",
                "verdict":"pass"
              }
            ]
          }
        ]
      }
    ],
    "service_platforms":[
      "SONATA"
    ],
    "test_category":[
      "benchmarking"
    ],
    "test_tags":[
      "rtmp-media-service"
    ],
    "test_descriptor_uuid":"deb05341-1337-1337-1337-1c3ecd41e51d",
    "package_descriptor_uuid":"9dfc1455-9593-4ac0-ae82-adb38fa8030a",
    "network_service_descriptor_uuid":"ee14669e-ebab-443f-8722-1c845aa65893",
    "service_instance_uuid":"36d29cca-b321-4f20-a07a-c860ed3f6f11"
  },
  "callbacks":[
    {
      "name":"running",
      "path":"http://tng-vnv-curator:6200/api/v1/test-preparations/afb557d8-6d4b-4963-813a-ed611abd2f67/change"
    },
    {
      "name":"cancel",
      "path":"http://tng-vnv-curator:6200/api/v1/test-preparations/afb557d8-6d4b-4963-813a-ed611abd2f67/tests/<test_uuid>/cancel"
    },
    {
      "name":"finish",
      "path":"http://tng-vnv-curator:6200/api/v1/test-preparations/afb557d8-6d4b-4963-813a-ed611abd2f67/tests/<test_uuid>/finish"
    }
  ]
}
